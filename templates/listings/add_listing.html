{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div class="container" style="max-width: 1000px; margin: 60px auto 40px;">
    <div style="text-align: center; margin-bottom: 40px;">
        {% if is_edit %}
        <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 10px;">Edit Property Listing</h1>
        <p style="color: #666; max-width: 700px; margin: 0 auto; line-height: 1.6;">
            As Madison, you can update the <strong>price</strong> and the <strong>listing status</strong> only.
        </p>
        {% else %}
        <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 10px;">Add New Property Listing</h1>
        <p style="color: #666; max-width: 700px; margin: 0 auto; line-height: 1.6;">
            Fill in the property details and upload exactly 4 photos.
        </p>
        {% endif %}
    </div>

    <div class="card" style="background: #fff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden;">
        <div style="background: #f8fafc; padding: 30px 40px; border-bottom: 1px solid #e2e8f0;">
            <h2 style="font-size: 24px; font-weight: 700; margin: 0; color: #111827;">Property Information</h2>
        </div>

        <div style="padding: 40px;">
            <form method="post"
                  {% if is_edit %}action="{% url 'edit_listing' listing.pk %}" {% endif %}
                  enctype="multipart/form-data">
                {% csrf_token %}
                {% if not is_edit %}
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div>{% include "listings/field.html" with field=form.address %}</div>
                    <div>{% include "listings/field.html" with field=form.price %}</div>
                    <div>{% include "listings/field.html" with field=form.property_type %}</div>
                    <div>{% include "listings/field.html" with field=form.neighborhood %}</div>
                    <div>{% include "listings/field.html" with field=form.bedrooms %}</div>
                    <div>{% include "listings/field.html" with field=form.bathrooms %}</div>
                </div>
                <div style="margin-bottom: 30px;">{% include "listings/field.html" with field=form.square_footage %}</div>
                <div style="margin-bottom: 30px;">{% include "listings/field.html" with field=form.description %}</div>
                <div style="margin-bottom: 30px;">{% include "listings/field.html" with field=form.photos %}</div>
                <div style="margin-bottom: 30px;">{% include "listings/field.html" with field=form.status_id %}</div>
                {% endif %}

                <!-- Read-only view when editing -->
                {% if is_edit %}
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">Address</label>
                        <div style="padding:14px 16px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px;">
                            {{ listing.address }}
                        </div>
                    </div>

                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">
                            Price <span style="color:#dc2626;">*</span>
                        </label>
                        {{ form.price }}
                        {% if form.price.errors %}
                        <div style="color:#dc2626; font-size:14px; margin-top:6px;">
                            {% for error in form.price.errors %}
                            {{ error }}<br>
                            {% endfor %}
                        </div>
                        {% endif %}
                        <p style="margin-top:4px; font-size:13px; color:#6b7280;">
                            Enter a numeric price, e.g. <strong>275000</strong>.
                        </p>
                    </div>

                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">Home Type</label>
                        <div style="padding:14px 16px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px;">
                            {{ listing.property_type.name }}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">Neighborhood</label>
                        <div style="padding:14px 16px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px;">
                            {{ listing.neighborhood.name }}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">Bedrooms</label>
                        <div style="padding:14px 16px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px;">
                            {{ listing.bedrooms }}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">Bathrooms</label>
                        <div style="padding:14px 16px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px;">
                            {{ listing.bathrooms }}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">Square Footage</label>
                        <div style="padding:14px 16px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px;">
                            {{ listing.square_footage|floatformat:0|intcomma }}
                        </div>
                    </div>
                    <div>
                        <label style="font-weight:600; margin-bottom:8px; display:block;">
                            Listing Status <span style="color:#dc2626;">*</span>
                        </label>
                        {{ form.status_id }}
                        {% if form.status_id.errors %}
                        <div style="color:#dc2626; font-size:14px; margin-top:6px;">
                            {% for error in form.status_id.errors %}
                            {{ error }}<br>
                            {% endfor %}
                        </div>
                {% endif %}
            </div>
        </div>

<div style="margin-bottom: 40px;">
    <label style="font-weight:600; margin-bottom:8px; display:block;">Description</label>
    <div style="padding:16px; background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px; line-height:1.6; min-height:80px;">
        {{ listing.description|default:"No description provided." }}
    </div>
</div>
{% endif %}


                <!-- Buttons -->
                <div style="display: flex; justify-content: flex-end; gap: 16px; margin-top: 40px;">
                    <a href="{% url 'listings' %}"
                       style="padding: 14px 32px; background: #fff; border: 1px solid #d1d5db; border-radius: 12px; color: #374151; text-decoration: none; font-weight: 600;">
                        Cancel
                    </a>
                    <button type="submit"
                            style="padding: 14px 40px; background: #869a77; color: white; border: none; border-radius: 12px; font-weight: 600; font-size: 16px; cursor: pointer;">
                        {% if is_edit %}Save Changes{% else %}Add Listing{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Styling for form fields and status dropdown -->
<style>
    .form-control, select#id_status_id {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid #cbd5e1;
        border-radius: 12px;
        background: white;
        font-size: 16px;
        font-family: "Lato", sans-serif;
    }

        .form-control:focus, #id_status_id:focus {
            outline: none;
            border-color: #869a77;
            box-shadow: 0 0 0 3px rgba(134,154,119,0.15);
        }

    select#id_status_id {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");
        background-position: right 16px center;
        background-repeat: no-repeat;
        background-size: 12px;
        padding-right: 40px;
    }
</style>
{% endblock %}
